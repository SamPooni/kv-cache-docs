<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chapter 3: Distributed Endpoint Architecture ‚Äî KV-Cache Offloading</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;400;500;600;700&family=IBM+Plex+Mono:wght@400;500;600&family=Fraunces:opsz,wght@9..144,400;9..144,600;9..144,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/style.css">
  <style>
    .figure-embed {
      background: var(--bg-card);
      border: 1px solid var(--border-primary);
      border-radius: 12px;
      margin: 2rem 0;
      overflow: hidden;
    }
    .figure-embed-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      background: var(--bg-tertiary);
      border-bottom: 1px solid var(--border-primary);
    }
    .figure-embed-label {
      font-family: var(--font-mono);
      font-size: 0.9rem;
      color: var(--accent-cyan);
    }
    .figure-embed-link {
      font-size: 0.85rem;
      color: var(--accent-purple);
      text-decoration: none;
    }
    .figure-embed-link:hover { text-decoration: underline; }
    .figure-embed iframe {
      width: 100%;
      height: 550px;
      border: none;
      background: #fff;
    }
    .figure-embed.tall iframe { height: 700px; }
  </style>
</head>
<body>
  <div class="watermark">¬© 2025 Subramaniyam (Sam) Pooni<br>All Rights Reserved<br>Proprietary & Confidential</div>

  <nav class="nav">
    <div class="nav-inner">
      <a href="../index.html" class="nav-brand"><span class="nav-brand-icon">‚ö°</span> KV-Cache Architecture</a>
      <div class="nav-links">
        <a href="ch00-executive-summary.html" class="nav-link"><span class="nav-chapter-num">0</span> Summary</a>
        <a href="ch03-architecture.html" class="nav-link active"><span class="nav-chapter-num">3</span> Architecture</a>
        <a href="ch07-kv-cache.html" class="nav-link"><span class="nav-chapter-num">7</span> KV-Cache</a>
        <a href="../figures/index.html" class="nav-link">üìä Figures</a>
        <a href="../appendix/index.html" class="nav-link">Appendix</a>
      </div>
    </div>
  </nav>

  <div class="page-wrapper">
    <div class="container">
      <header class="chapter-header">
        <div class="chapter-label">Chapter 3</div>
        <h1 class="chapter-title">Distributed Endpoint Architecture</h1>
        <p class="chapter-subtitle">CXL 3.0 computational storage endpoints with controller-resident intelligence for autonomous KV-cache management.</p>
      </header>

      <div class="stats-grid" style="margin-bottom: 3rem;">
        <div class="stat-box"><div class="stat-value">11</div><div class="stat-label">Figures in Chapter</div></div>
        <div class="stat-box"><div class="stat-value">250 ns</div><div class="stat-label">CXL Latency</div></div>
        <div class="stat-box"><div class="stat-value">65√ó</div><div class="stat-label">vs PCIe DMA</div></div>
        <div class="stat-box"><div class="stat-value">1 TB</div><div class="stat-label">DRAM Capacity</div></div>
      </div>

      <!-- Section 3.1: Core Concept -->
      <h2>3.1 Controller Offloading Concept</h2>
      
      <p>Instead of passive memory managed by CPU, we deploy <strong>intelligent computational storage endpoints</strong> with their own ARM processors that autonomously manage cache placement, eviction, and prefetching.</p>

      <div class="comparison-grid">
        <div class="card" style="border-color: var(--accent-red);">
          <h4 style="color: var(--accent-red); margin-top: 0;">‚ùå Traditional: CPU-Managed</h4>
          <ul style="font-size: 0.9rem; margin-bottom: 0;">
            <li>CPU in critical path</li>
            <li>5-10 Œºs latency</li>
            <li>No predictive prefetch</li>
            <li>System RAM contention</li>
          </ul>
        </div>
        <div class="card" style="border-color: var(--accent-green);">
          <h4 style="color: var(--accent-green); margin-top: 0;">‚úì Our Approach: Endpoint-Managed</h4>
          <ul style="font-size: 0.9rem; margin-bottom: 0;">
            <li>Direct GPU ‚Üî Endpoint</li>
            <li>250 ns latency (40√ó faster)</li>
            <li>Autonomous prefetch</li>
            <li>Dedicated memory pool</li>
          </ul>
        </div>
      </div>

      <div class="figure-embed tall">
        <div class="figure-embed-header">
          <span class="figure-embed-label">Figure 3.1 ‚Äî Complete System Architecture</span>
          <a href="../figures/ch03-architecture/diagram-architecture-html.html" target="_blank" class="figure-embed-link">Open Full Screen ‚Üó</a>
        </div>
        <iframe src="../figures/ch03-architecture/diagram-architecture-html.html"></iframe>
      </div>

      <!-- Section 3.2: Endpoint Architecture -->
      <h2>3.2 Endpoint Internal Architecture</h2>
      
      <div class="table-wrapper">
        <table>
          <thead>
            <tr><th>Component</th><th>Specification</th><th>Purpose</th></tr>
          </thead>
          <tbody>
            <tr><td>Controller</td><td class="mono">ARM Cortex-A78 (4-8 cores)</td><td>Cache management intelligence</td></tr>
            <tr><td>DRAM</td><td class="mono">256 GB DDR5-5600</td><td>Hot KV-cache tier</td></tr>
            <tr><td>Flash</td><td class="mono">4 TB NVMe Gen5</td><td>Cold tier + overflow</td></tr>
            <tr><td>CXL Controller</td><td class="mono">Type-3 Device</td><td>GPU memory access</td></tr>
            <tr><td>Uplink</td><td class="mono">√ó16 PCIe Gen5 (64 GB/s)</td><td>Host connection</td></tr>
          </tbody>
        </table>
      </div>

      <div class="figure-embed">
        <div class="figure-embed-header">
          <span class="figure-embed-label">Figure 3.2 ‚Äî Endpoint Internal Components</span>
          <a href="../figures/ch03-architecture/endpoint-diagram.html" target="_blank" class="figure-embed-link">Open Full Screen ‚Üó</a>
        </div>
        <iframe src="../figures/ch03-architecture/endpoint-diagram.html"></iframe>
      </div>

      <!-- Section 3.3: CXL Architecture -->
      <h2>3.3 CXL 3.0 Architecture</h2>
      
      <p>CXL (Compute Express Link) provides cache-coherent memory access with load/store semantics‚Äîno explicit DMA required.</p>

      <div class="table-wrapper">
        <table>
          <thead>
            <tr><th>Protocol</th><th>Direction</th><th>Purpose</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>CXL.io</strong></td><td>Bidirectional</td><td>PCIe-equivalent I/O, config, interrupts</td></tr>
            <tr><td><strong>CXL.cache</strong></td><td>Device ‚Üí Host</td><td>Device caches host memory</td></tr>
            <tr><td style="color: var(--accent-cyan);"><strong>CXL.mem</strong></td><td>Host ‚Üí Device</td><td>Host accesses device memory (our primary)</td></tr>
          </tbody>
        </table>
      </div>

      <div class="figure-embed tall">
        <div class="figure-embed-header">
          <span class="figure-embed-label">Figure 3.3 ‚Äî CXL Architecture Diagram</span>
          <a href="../figures/ch03-architecture/cxl-architecture-diagram.html" target="_blank" class="figure-embed-link">View TSX Source ‚Üó</a>
        </div>
        <iframe src="../figures/ch03-architecture/cxl-architecture-diagram.html" style="background: #1a1a2e;"></iframe>
      </div>

      <!-- Section 3.4: Memory Hierarchy -->
      <h2>3.4 Three-Tier Memory Hierarchy</h2>
      
      <div class="table-wrapper">
        <table>
          <thead>
            <tr><th>Tier</th><th>Media</th><th>Capacity</th><th>Latency</th><th>Contents</th></tr>
          </thead>
          <tbody>
            <tr><td>Tier 0</td><td>GPU HBM (Pinned)</td><td class="mono">~5 GB</td><td class="mono highlight">100 ns</td><td>Model weights, active layer</td></tr>
            <tr><td>Tier 1</td><td>GPU HBM (Evictable)</td><td class="mono">~37 GB</td><td class="mono highlight">100 ns</td><td>Hot KV-cache entries</td></tr>
            <tr><td>Tier 2</td><td>CXL DRAM</td><td class="mono">1 TB</td><td class="mono">250 ns</td><td>Warm KV-cache entries</td></tr>
            <tr><td>Tier 3</td><td>NVMe Flash</td><td class="mono">16 TB</td><td class="mono warning">25 Œºs</td><td>Cold entries, overflow</td></tr>
          </tbody>
        </table>
      </div>

      <div class="figure-embed">
        <div class="figure-embed-header">
          <span class="figure-embed-label">Figure 3.4 ‚Äî Memory Hierarchy Visualization</span>
          <a href="../figures/ch03-architecture/figure-3-2-memory-hierarchy.html" target="_blank" class="figure-embed-link">View TSX Source ‚Üó</a>
        </div>
        <iframe src="../figures/ch03-architecture/figure-3-2-memory-hierarchy.html" style="background: #1a1a2e;"></iframe>
      </div>

      <!-- Section 3.5: Topology -->
      <h2>3.5 System Topology (4 Endpoints)</h2>

      <div class="callout insight">
        <div class="callout-title">üí° Why 4 Endpoints?</div>
        <p style="margin-bottom: 0;">4 endpoints provide optimal cost/performance balance: <strong>1 TB DRAM</strong>, <strong>256 GB/s aggregate bandwidth</strong>, and <strong>~$5K cost</strong>. Adding more endpoints yields diminishing returns due to switch overhead.</p>
      </div>

      <div class="stats-grid">
        <div class="stat-box"><div class="stat-value">1.2 TB</div><div class="stat-label">Total Capacity</div></div>
        <div class="stat-box"><div class="stat-value">256 GB/s</div><div class="stat-label">Aggregate BW</div></div>
        <div class="stat-box"><div class="stat-value">250 ns</div><div class="stat-label">DRAM Latency</div></div>
        <div class="stat-box"><div class="stat-value">~$5K</div><div class="stat-label">Per Endpoint</div></div>
      </div>

      <!-- Chapter Navigation -->
      <div class="chapter-nav">
        <a href="ch02-background.html" class="chapter-nav-btn prev">
          <span class="chapter-nav-label">‚Üê Previous</span>
          <span class="chapter-nav-title">Chapter 2: Background</span>
        </a>
        <a href="ch04-latency.html" class="chapter-nav-btn next">
          <span class="chapter-nav-label">Next ‚Üí</span>
          <span class="chapter-nav-title">Chapter 4: Latency Analysis</span>
        </a>
      </div>
    </div>

    <footer class="footer">
      <div style="margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-primary);">
        <p style="font-size: 0.8rem; color: var(--text-muted);">
          ¬© 2025 Subramaniyam (Sam) Pooni. All Rights Reserved.<br>
          This document contains proprietary and confidential information.
        </p>
      </div>
      <p>KV-Cache Offloading Architecture ‚Äî v3.0</p>
    </footer>
  </div>
</body>
</html>
