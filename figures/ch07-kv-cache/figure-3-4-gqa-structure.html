<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Figure 3.4 — GQA Structure</title>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<style>* { box-sizing: border-box; margin: 0; padding: 0; } body { font-family: system-ui, sans-serif; background: linear-gradient(135deg, #0f172a, #1e293b); min-height: 100vh; color: #e2e8f0; }</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState } = React;
function GQAStructure() {
  const [mode, setMode] = useState('gqa');
  const configs = {
    mha: { name: 'MHA', qHeads: 8, kvHeads: 8, ratio: '1:1', savings: '0%', color: '#ef4444' },
    gqa: { name: 'GQA', qHeads: 8, kvHeads: 2, ratio: '4:1', savings: '75%', color: '#10b981' },
    mqa: { name: 'MQA', qHeads: 8, kvHeads: 1, ratio: '8:1', savings: '87.5%', color: '#3b82f6' }
  };
  const c = configs[mode];
  const styles = {
    container: { maxWidth: '800px', margin: '0 auto', padding: '2rem' },
    header: { textAlign: 'center', marginBottom: '2rem' },
    badge: { display: 'inline-block', padding: '0.25rem 0.75rem', background: 'rgba(16,185,129,0.2)', color: '#34d399', fontSize: '0.75rem', fontFamily: 'monospace', borderRadius: '20px', marginBottom: '0.5rem' },
    tabs: { display: 'flex', justifyContent: 'center', gap: '0.5rem', marginBottom: '2rem' },
    tab: (active, color) => ({ padding: '0.75rem 1.5rem', background: active ? color : '#334155', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer', fontWeight: 600 }),
    diagram: { background: '#1e293b', borderRadius: '16px', padding: '2rem', marginBottom: '1.5rem' },
    row: { display: 'flex', justifyContent: 'center', gap: '0.5rem', marginBottom: '1rem' },
    head: (color) => ({ width: 40, height: 40, borderRadius: 8, background: color, display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '0.7rem', fontWeight: 600, color: 'white' }),
    arrow: { textAlign: 'center', color: '#64748b', fontSize: '1.5rem', margin: '0.5rem 0' },
    stats: { display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '1rem' },
    stat: { background: '#0f172a', borderRadius: '12px', padding: '1rem', textAlign: 'center' },
    statVal: (color) => ({ fontSize: '1.5rem', fontWeight: 700, color }),
    statLabel: { fontSize: '0.75rem', color: '#64748b', marginTop: '0.25rem' }
  };
  return (
    <div style={styles.container}>
      <div style={styles.header}>
        <div style={styles.badge}>FIGURE 3.4</div>
        <h1 style={{fontSize: '1.75rem', fontWeight: 700, marginBottom: '0.5rem'}}>Grouped Query Attention</h1>
        <p style={{color: '#94a3b8'}}>How GQA reduces KV-cache size</p>
      </div>
      <div style={styles.tabs}>
        {Object.entries(configs).map(([k, v]) => (
          <button key={k} style={styles.tab(mode === k, v.color)} onClick={() => setMode(k)}>{v.name}</button>
        ))}
      </div>
      <div style={styles.diagram}>
        <div style={{textAlign: 'center', color: '#60a5fa', fontSize: '0.875rem', marginBottom: '1rem'}}>Query Heads ({c.qHeads})</div>
        <div style={styles.row}>
          {Array(c.qHeads).fill(0).map((_, i) => <div key={i} style={styles.head('#3b82f6')}>Q{i}</div>)}
        </div>
        <div style={styles.arrow}>↓ attend to ↓</div>
        <div style={styles.row}>
          {Array(c.kvHeads).fill(0).map((_, i) => <div key={i} style={styles.head(c.color)}>KV{i}</div>)}
        </div>
        <div style={{textAlign: 'center', color: c.color, fontSize: '0.875rem', marginTop: '1rem'}}>KV Heads ({c.kvHeads})</div>
      </div>
      <div style={styles.stats}>
        <div style={styles.stat}><div style={styles.statVal(c.color)}>{c.ratio}</div><div style={styles.statLabel}>Q:KV Ratio</div></div>
        <div style={styles.stat}><div style={styles.statVal(c.color)}>{c.savings}</div><div style={styles.statLabel}>Memory Savings</div></div>
        <div style={styles.stat}><div style={styles.statVal(c.color)}>{c.kvHeads}</div><div style={styles.statLabel}>KV Heads</div></div>
      </div>
    </div>
  );
}
ReactDOM.createRoot(document.getElementById('root')).render(<GQAStructure />);
</script>
</body>
</html>
